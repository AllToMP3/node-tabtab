#!/usr/bin/env node
var completion = require('../lib/completion'),
  exec = require('child_process').exec,
  path = require('path');

var parseTasks = completion.parseTasks,
  parseOut = completion.parseOut,
  log = completion.log;

completion.complete('cake', 'cake-complete', function(err, o) {
  if(err || !o) return;

  return exec('cake', function(err, stdout, stderr)Â {
    if(err) return;
    var parsed = parseOut(stdout),
      tasks = parseTasks(stdout, 'cake');

    if(/^--\w?/.test(o.last)) return log(parsed.longs, o, '--');
    if(/^-\w?/.test(o.last)) return log(parsed.shorts, o, '-');
    log(tasks, o);
  });
});

